<!-- File name: reels-fi.html -->
<!-- Put this file in the same folder as your videos (video-1.mp4, video-2.mp4, video-3.mp4) -->
<!doctype html>
<html lang="fi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Reels-syöte</title>
    <style>
      :root{
        --bg:#07070a;
        --stroke:rgba(255,255,255,.10);
      }
      *{ box-sizing:border-box; }
      html,body{ height:100%; }
      body{
        margin:0;
        background:var(--bg);
        overflow:hidden;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
        color:#fff;
      }

      .feed{
        height:100vh;
        height:100dvh;
        overflow-y:auto;
        scroll-snap-type:y mandatory;
        -webkit-overflow-scrolling:touch;
        background:#000;
      }

      .item{
        height:100vh;
        height:100dvh;
        scroll-snap-align:start;
        position:relative;
        background:#000;
      }

      .reel{
        position:absolute;
        inset:0;
        background:#000;
        overflow:hidden;
        isolation:isolate;
      }

      video{
        width:100%;
        height:100%;
        display:block;
        object-fit:cover;
        background:#000;
      }

      .topFade{
        position:absolute; left:0; right:0; top:0;
        height:140px;
        background:linear-gradient(to bottom, rgba(0,0,0,.65), rgba(0,0,0,0));
        pointer-events:none;
        z-index:3;
      }
      .botFade{
        position:absolute; left:0; right:0; bottom:0;
        height:220px;
        background:linear-gradient(to top, rgba(0,0,0,.72), rgba(0,0,0,0));
        pointer-events:none;
        z-index:3;
      }

      /* Middle play button */
      .midOverlay{
        position:absolute;
        inset:0;
        display:grid;
        place-items:center;
        pointer-events:none;
        z-index:5;
      }
      .midPlayBtn{
        pointer-events:auto;
        width:88px;
        height:88px;
        border-radius:999px;
        border:1px solid rgba(255,255,255,.18);
        background:rgba(0,0,0,.35);
        backdrop-filter: blur(10px);
        display:grid;
        place-items:center;
        opacity:0;
        transform: translateY(6px);
        transition: opacity .15s ease, transform .15s ease, background .15s ease;
      }
      .midPlayBtn:hover{ background:rgba(0,0,0,.5); }
      .midPlayBtn:active{ transform: translateY(7px); }
      .midPlayBtn svg{ width:34px; height:34px; fill:#fff; margin-left:3px; }
      .reel.is-paused .midPlayBtn{ opacity:1; transform: translateY(0); }

      .rail{
        position:absolute;
        right:12px;
        bottom:92px;
        display:flex;
        flex-direction:column;
        gap:16px;
        z-index:6;
        pointer-events:auto;
      }

      .action{
        display:flex;
        flex-direction:column;
        align-items:center;
        gap:6px;
        user-select:none;
      }

      .btn{
        width:46px;
        height:46px;
        border-radius:999px;
        border:1px solid rgba(255,255,255,.14);
        background:rgba(0,0,0,.25);
        backdrop-filter: blur(10px);
        display:grid;
        place-items:center;
        cursor:pointer;
        transition: transform .08s ease, background .12s ease;
      }
      .btn:hover{ background: rgba(0,0,0,.38); }
      .btn:active{ transform: translateY(1px); }
      .btn svg{ width:22px; height:22px; fill:#fff; }

      .count{
        font-size:12px;
        color:rgba(255,255,255,.95);
        text-shadow: 0 6px 22px rgba(0,0,0,.65);
      }

      .btn.like.is-on svg{ fill:#ff2d55; }
      .btn.save.is-on svg{ fill:#ffd60a; }

      .controls{
        position:absolute;
        left:0; right:0; bottom:0;
        padding: 0 12px max(12px, env(safe-area-inset-bottom));
        z-index:7;
        pointer-events:none;
      }
      .progressWrap{ pointer-events:auto; padding-bottom: 10px; }
      .progress{
        width:100%;
        height:3px;
        border-radius:999px;
        background: rgba(255,255,255,.22);
        appearance:none;
        outline:none;
        cursor:pointer;
      }
      .progress::-webkit-slider-thumb{
        appearance:none;
        width:14px; height:14px;
        border-radius:999px;
        background:#fff;
        border:0;
        box-shadow: 0 0 0 6px rgba(255,255,255,.12);
      }
      .progress::-moz-range-thumb{
        width:14px; height:14px;
        border-radius:999px;
        background:#fff;
        border:0;
        box-shadow: 0 0 0 6px rgba(255,255,255,.12);
      }

      .bottomRow{
        pointer-events:auto;
        display:flex;
        align-items:center;
        justify-content:flex-end;
      }
      .miniBtn{
        width:42px; height:42px;
        border-radius:999px;
        border:1px solid rgba(255,255,255,.14);
        background:rgba(0,0,0,.25);
        backdrop-filter: blur(10px);
        display:grid;
        place-items:center;
        cursor:pointer;
      }
      .miniBtn svg{ width:20px; height:20px; fill:#fff; }

      /* Big heart burst */
      .heartBurst{
        position:absolute;
        left:50%; top:50%;
        transform: translate(-50%, -50%) scale(.6);
        width:120px; height:120px;
        z-index:8;
        pointer-events:none;
        opacity:0;
      }
      .heartBurst.show{ animation: pop 650ms ease forwards; }
      .heartBurst svg{
        width:100%;
        height:100%;
        filter: drop-shadow(0 18px 40px rgba(0,0,0,.55));
      }
      @keyframes pop{
        0%   { opacity:0; transform: translate(-50%, -50%) scale(.5); }
        15%  { opacity:1; transform: translate(-50%, -50%) scale(1.05); }
        55%  { opacity:1; transform: translate(-50%, -50%) scale(1.0); }
        100% { opacity:0; transform: translate(-50%, -62%) scale(1.15); }
      }

      /* Floating hearts */
      .floatHeart{
        position:absolute;
        left:50%; top:52%;
        transform: translate(-50%, -50%);
        width:22px; height:22px;
        z-index:8;
        pointer-events:none;
        opacity:0.95;
        animation: floatUp 900ms ease forwards;
        filter: drop-shadow(0 10px 22px rgba(0,0,0,.5));
      }
      @keyframes floatUp{
        0%   { opacity:0; transform: translate(-50%, -50%) scale(.9); }
        10%  { opacity:1; }
        100% { opacity:0; transform: translate(calc(-50% + var(--dx)), calc(-50% - 140px)) scale(1.2); }
      }

      @media (max-width:420px){
        .rail{ right:10px; bottom:86px; }
      }
    </style>
  </head>

  <body>
    <div class="feed" id="feed" aria-label="Reels-syöte"></div>

    <script>
      // ✅ Video file names (same folder as reels-fi.html)
      const VIDEOS = ["video-1.mp4", "video-2.mp4", "video-3.mp4"];

      const ICONS = {
        vol: '<path d="M3 10v4h4l5 4V6L7 10H3z"></path>',
        mute:
          '<path d="M3 10v4h4l5 4V6L7 10H3z"></path>' +
          '<path d="M16 9l5 5m0-5l-5 5" stroke="white" stroke-width="2" stroke-linecap="round"></path>',
        play: '<path d="M8 5v14l11-7z"></path>',
      };

      function clamp(n, a, b) { return Math.min(b, Math.max(a, n)); }

      function parseLike(text) {
        const t = text.toUpperCase().replace(",", ".");
        if (t.endsWith("K")) return Math.round(parseFloat(t) * 1000);
        if (t.endsWith("M")) return Math.round(parseFloat(t) * 1000000);
        const n = parseInt(t.replace(/\D/g, ""), 10);
        return Number.isFinite(n) ? n : 0;
      }

      function formatLikeFi(n) {
        if (n >= 1000000) return (Math.round((n / 1000000) * 10) / 10).toString().replace(".", ",") + "M";
        if (n >= 1000) return (Math.round((n / 1000) * 10) / 10).toString().replace(".", ",") + "K";
        return String(n);
      }

      function vibrate(ms = 18) {
        try { if (navigator.vibrate) navigator.vibrate(ms); } catch (_) {}
      }

      function showHeartAnimation(reel) {
        const burst = reel.querySelector("[data-heartburst]");
        if (!burst) return;

        burst.classList.remove("show");
        void burst.offsetWidth;
        burst.classList.add("show");

        for (let i = 0; i < 6; i++) {
          const h = document.createElement("div");
          h.className = "floatHeart";
          h.style.setProperty("--dx", `${(Math.random() * 140 - 70).toFixed(0)}px`);
          h.innerHTML = `
            <svg viewBox="0 0 24 24">
              <path fill="#ff2d55" d="M12 21s-7-4.35-9.33-8.02C.48 9.2 2.1 5.9 5.53 5.2c1.9-.39 3.73.29 4.97 1.57 1.24-1.28 3.07-1.96 4.97-1.57 3.43.7 5.05 4 2.86 7.78C19 16.65 12 21 12 21z"/>
            </svg>`;
          reel.appendChild(h);
          setTimeout(() => h.remove(), 950);
        }
      }

      function reelTemplate(src, likeText) {
        return `
          <section class="item">
            <div class="reel is-paused" data-reel>
              <video playsinline preload="metadata" muted loop disablepictureinpicture
                     controlslist="nofullscreen noremoteplayback nodownload" data-video>
                <source src="${src}" type="video/mp4" />
              </video>

              <div class="topFade"></div>
              <div class="botFade"></div>

              <!-- ✅ Middle play button -->
              <div class="midOverlay" aria-hidden="true">
                <button class="midPlayBtn" type="button" aria-label="Toista" data-midplay>
                  <svg viewBox="0 0 24 24">${ICONS.play}</svg>
                </button>
              </div>

              <div class="heartBurst" data-heartburst aria-hidden="true">
                <svg viewBox="0 0 24 24">
                  <path fill="#ff2d55" d="M12 21s-7-4.35-9.33-8.02C.48 9.2 2.1 5.9 5.53 5.2c1.9-.39 3.73.29 4.97 1.57 1.24-1.28 3.07-1.96 4.97-1.57 3.43.7 5.05 4 2.86 7.78C19 16.65 12 21 12 21z"/>
                </svg>
              </div>

              <div class="rail" aria-label="Toiminnot">
                <div class="action">
                  <button class="btn like" type="button" aria-label="Tykkää" data-like>
                    <svg viewBox="0 0 24 24">
                      <path d="M12 21s-7-4.35-9.33-8.02C.48 9.2 2.1 5.9 5.53 5.2c1.9-.39 3.73.29 4.97 1.57 1.24-1.28 3.07-1.96 4.97-1.57 3.43.7 5.05 4 2.86 7.78C19 16.65 12 21 12 21z"></path>
                    </svg>
                  </button>
                  <div class="count" data-like-count>${likeText}</div>
                </div>

                <div class="action">
                  <button class="btn" type="button" aria-label="Kommentoi" data-comment>
                    <svg viewBox="0 0 24 24">
                      <path d="M21 6.5a4.5 4.5 0 0 0-4.5-4.5h-9A4.5 4.5 0 0 0 3 6.5v7A4.5 4.5 0 0 0 7.5 18H9l3 3 3-3h1.5A4.5 4.5 0 0 0 21 13.5v-7z"></path>
                    </svg>
                  </button>
                  <div class="count">Kommentit</div>
                </div>

                <div class="action">
                  <button class="btn" type="button" aria-label="Jaa" data-share>
                    <svg viewBox="0 0 24 24">
                      <path d="M21 3 3 10l7 2 2 7 9-18zM10 12l11-9"></path>
                    </svg>
                  </button>
                  <div class="count">Jaa</div>
                </div>

                <div class="action">
                  <button class="btn save" type="button" aria-label="Tallenna" data-save>
                    <svg viewBox="0 0 24 24">
                      <path d="M6 2h12a2 2 0 0 1 2 2v18l-8-5-8 5V4a2 2 0 0 1 2-2z"></path>
                    </svg>
                  </button>
                  <div class="count">Tallenna</div>
                </div>
              </div>

              <div class="controls">
                <div class="progressWrap">
                  <input class="progress" type="range" min="0" max="1000" value="0" aria-label="Kelaa" data-seek />
                </div>
                <div class="bottomRow">
                  <button class="miniBtn" type="button" aria-label="Mykistä/poista mykistys" data-mute>
                    <svg data-mute-icon viewBox="0 0 24 24">${ICONS.mute}</svg>
                  </button>
                </div>
              </div>
            </div>
          </section>
        `;
      }

      function setupReel(reel) {
        const video = reel.querySelector("[data-video]");
        const seek = reel.querySelector("[data-seek]");
        const muteBtn = reel.querySelector("[data-mute]");
        const muteIcon = reel.querySelector("[data-mute-icon]");
        const likeBtn = reel.querySelector("[data-like]");
        const likeCountEl = reel.querySelector("[data-like-count]");
        const saveBtn = reel.querySelector("[data-save]");
        const commentBtn = reel.querySelector("[data-comment]");
        const shareBtn = reel.querySelector("[data-share]");
        const midPlay = reel.querySelector("[data-midplay]");

        let liked = false;
        let saved = false;
        let lastTapTs = 0;

        function setPausedUI(paused) {
          reel.classList.toggle("is-paused", paused);
        }

        function setMuteUI() {
          muteIcon.innerHTML = (video.muted || video.volume === 0) ? ICONS.mute : ICONS.vol;
        }

        function syncSeek() {
          const dur = video.duration || 0;
          if (dur <= 0) return;
          seek.value = String(Math.round((video.currentTime / dur) * 1000));
        }

        function seekTo(val) {
          const dur = video.duration || 0;
          if (dur <= 0) return;
          video.currentTime = dur * (Number(val) / 1000);
        }

        async function togglePlay() {
          if (video.paused) {
            try { await video.play(); } catch (_) {}
          } else {
            video.pause();
          }
        }

        function setLiked(on, anim) {
          liked = on;
          likeBtn.classList.toggle("is-on", liked);
          if (likeCountEl) {
            const n = parseLike(likeCountEl.textContent.trim());
            likeCountEl.textContent = formatLikeFi(clamp(n + (liked ? 1 : -1), 0, 999999999));
          }
          if (anim) {
            vibrate(22);
            showHeartAnimation(reel);
          }
        }

        // Middle play button
        midPlay.addEventListener("click", (e) => {
          e.stopPropagation();
          togglePlay();
        });

        // Single tap: play/pause. Double tap: like + heart + vibrate.
        video.addEventListener("click", (e) => {
          const now = Date.now();
          const delta = now - lastTapTs;
          lastTapTs = now;

          if (delta < 280) {
            if (!liked) setLiked(true, true);
            else { vibrate(18); showHeartAnimation(reel); }
            e.preventDefault();
            return;
          }
          togglePlay();
        });

        likeBtn.addEventListener("click", () => setLiked(!liked, true));

        saveBtn?.addEventListener("click", () => {
          saved = !saved;
          saveBtn.classList.toggle("is-on", saved);
          vibrate(12);
        });

        commentBtn?.addEventListener("click", () => alert("Kommentit (demo)"));

        shareBtn?.addEventListener("click", async () => {
          const url = location.href;
          try {
            if (navigator.share) await navigator.share({ title: document.title, url });
            else await navigator.clipboard.writeText(url);
            vibrate(12);
          } catch (_) {}
        });

        seek.addEventListener("input", () => seekTo(seek.value));
        video.addEventListener("timeupdate", syncSeek);
        video.addEventListener("loadedmetadata", syncSeek);

        muteBtn.addEventListener("click", () => {
          video.muted = !video.muted;
          if (!video.muted && video.volume === 0) video.volume = 1;
          setMuteUI();
          vibrate(10);
        });

        video.addEventListener("volumechange", setMuteUI);
        video.addEventListener("play", () => setPausedUI(false));
        video.addEventListener("pause", () => setPausedUI(true));

        // Autoplay rules: muted autoplay
        video.muted = true;
        video.volume = 0;
        setMuteUI();
        setPausedUI(true);

        return { reel, video };
      }

      // Build feed
      const feed = document.getElementById("feed");
      const likePreset = ["12,3K", "2,1K", "901", "5,4K", "77"];
      feed.innerHTML = VIDEOS.map((src, i) => reelTemplate(src, likePreset[i % likePreset.length])).join("");

      const reels = [...document.querySelectorAll("[data-reel]")].map(setupReel);

      // Autoplay visible reel
      const io = new IntersectionObserver((entries) => {
        for (const e of entries) {
          const r = reels.find(x => x.reel === e.target);
          if (!r) continue;

          if (e.isIntersecting && e.intersectionRatio >= 0.75) {
            for (const o of reels) {
              if (o !== r && !o.video.paused) o.video.pause();
            }
            r.video.play().catch(() => {});
          } else {
            if (!r.video.paused) r.video.pause();
          }
        }
      }, { threshold: [0, 0.75, 1] });

      reels.forEach(r => io.observe(r.reel));

      // Snap after scroll stops
      let t;
      feed.addEventListener("scroll", () => {
        clearTimeout(t);
        t = setTimeout(() => {
          const vh = feed.clientHeight || window.innerHeight;
          const idx = Math.round(feed.scrollTop / vh);
          feed.scrollTo({ top: idx * vh, behavior: "smooth" });
        }, 120);
      });
    </script>
  </body>
</html>